const fs = require("fs");

module.exports.textToJson = function(dataFile, destinationFile) {
  let textByLine = fs.readFileSync(dataFile, "utf-8").split("\n");
  let firstLine = textByLine.shift();
  let header = firstLine.split(/\s+/);
  header.pop();
  let result = [];

  let width = firstLine.split("").reduce(function(acc, c, i, arr){
  	if(c === " " && arr[i+1] !== " ") acc.push(i)
  	return acc;
  }, [0]);

  textByLine.forEach(line => {
    let temp = header.reduce((acc, heading, i, h) => {
      acc[h[i]] = line.slice(width[i], width[i+1]).trim();
      return acc;
    }, {})
    result.push(temp);
  });

  result.pop();
  fs.writeFileSync(destinationFile, JSON.stringify(result));
}
